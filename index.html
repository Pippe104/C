<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flowers</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: radial-gradient(circle at center, #1a2a35, #0a1419);
    font-family: 'Arial', sans-serif;
}

canvas {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
}

.overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 20;
    width: 100%;
    pointer-events: none;
}

.valentine-message {
    color: white;
    font-size: 2.2rem;
    font-weight: bold;
    text-shadow: 0 0 40px rgba(255, 120, 120, 0.8), 0 0 20px rgba(255, 100, 100, 0.6);
    margin-bottom: 1.5rem;
    letter-spacing: 4px;
    animation: pulse 2s infinite;
    pointer-events: none;
    font-family: 'Georgia', serif;
    padding: 0 20px;
}

@keyframes pulse {
    0% { text-shadow: 0 0 40px rgba(255, 120, 120, 0.8), 0 0 20px rgba(255, 100, 100, 0.6); }
    50% { text-shadow: 0 0 60px rgba(255, 150, 150, 1), 0 0 30px rgba(255, 120, 120, 0.9); }
    100% { text-shadow: 0 0 40px rgba(255, 120, 120, 0.8), 0 0 20px rgba(255, 100, 100, 0.6); }
}

.buttons-container {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    align-items: center;
    pointer-events: auto;
    position: relative;
    margin-top: 1.5rem;
    flex-wrap: wrap;
}

.btn {
    padding: 0.8rem 2rem;
    font-size: 1.3rem;
    font-weight: bold;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    letter-spacing: 2px;
}

.btn-yes {
    background: linear-gradient(45deg, #ff4d4d, #ff1a1a);
    color: white;
    border: 2px solid #fff;
    transform-origin: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    z-index: 30;
}

.btn-yes:hover {
    box-shadow: 0 0 30px rgba(255, 77, 77, 0.6);
}

.btn-no {
    background: linear-gradient(45deg, #666, #444);
    color: white;
    border: 2px solid #ccc;
    position: relative;
    transition: all 0.2s ease;
    cursor: pointer;
    z-index: 40;
}

.btn-no:hover {
    background: linear-gradient(45deg, #777, #555);
}

.success-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.95);
    color: #ff1a1a;
    padding: 2rem 3rem;
    border-radius: 20px;
    font-size: 2rem;
    font-weight: bold;
    z-index: 100;
    box-shadow: 0 0 100px rgba(255, 77, 77, 0.5);
    animation: popIn 0.5s ease;
    border: 3px solid #ff4d4d;
    text-align: center;
    pointer-events: none;
}

@keyframes popIn {
    0% { transform: translate(-50%, -50%) scale(0); }
    80% { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
}

.heart {
    color: #ff1a1a;
    font-size: 3.5rem;
    margin-bottom: 0.8rem;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="overlay">
    <div class="valentine-message">C will u be my valentine?</div>
    
    <div class="buttons-container">
        <button class="btn btn-yes" id="yesBtn">Sì ❤️</button>
        <button class="btn btn-no" id="noBtn">No</button>
    </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// RILEVA SE È DISPOSITIVO MOBILE
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ---------------- PETALI CADENTI - OPTIMIZED PER MOBILE ---------------- */

class Petalo {
    constructor(isHeart = false) {
        this.isHeart = isHeart;
        this.reset();
    }

    reset() {
        this.x = Math.random() * canvas.width;
        this.y = -20;
        this.vy = 0.6 + Math.random() * 1.5; // Più lento
        this.vx = -0.4 + Math.random() * 0.8; // Meno movimento laterale
        this.size = isMobile ? 4 + Math.random() * 8 : 6 + Math.random() * 12; // Più piccoli su mobile
        this.alpha = 0.4 + Math.random() * 0.3; // Meno opachi
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.01; // Più lento
        
        if (this.isHeart) {
            const colors = ["#ff4d4d", "#ff1a1a", "#ff6666"];
            this.color = colors[Math.floor(Math.random() * colors.length)];
        } else {
            const colors = [
                "#ffb7c5", "#ff9eb5", "#ffb3ba", "#ffc0cb"
            ];
            this.color = colors[Math.floor(Math.random() * colors.length)];
        }
        this.secondColor = "#fff0f5";
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotationSpeed;
        
        this.vx += (Math.random() - 0.5) * 0.02;
        this.vy += 0.003;

        if (this.y > canvas.height + 20 || 
            this.x < -20 || 
            this.x > canvas.width + 20) {
            this.reset();
        }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.globalAlpha = this.alpha;
        
        ctx.shadowColor = "rgba(0, 0, 0, 0.1)";
        ctx.shadowBlur = 3;
        ctx.shadowOffsetX = 1;
        ctx.shadowOffsetY = 1;

        if (this.isHeart) {
            // Disegna un cuore
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(-this.size/2, -this.size/2, -this.size, this.size/3, 0, this.size);
            ctx.bezierCurveTo(this.size, this.size/3, this.size/2, -this.size/2, 0, 0);
            ctx.fill();
        } else {
            // Disegna un petalo
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.ellipse(0, 0, this.size, this.size * 0.5, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        ctx.restore();
    }
}

/* ---------------- FIORI SFONDO - RIDOTTI PER MOBILE ---------------- */

class Flower {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = isMobile ? 20 + Math.random() * 30 : 30 + Math.random() * 40;
        this.petalCount = isMobile ? 5 + Math.floor(Math.random() * 3) : 5 + Math.floor(Math.random() * 4);
        this.petalLayers = isMobile ? 1 : (Math.random() > 0.6 ? 2 : 1); // Solo 1 strato su mobile
        this.alpha = isMobile ? 0.1 + Math.random() * 0.08 : 0.15 + Math.random() * 0.1;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.0005;
        
        const palettes = [
            { petal: ["#fce4e8", "#f8bbd0"], center: ["#ffecb3", "#ffe082"] },
            { petal: ["#e8eaf6", "#c5cae9"], center: ["#fff9c4", "#fff59d"] },
            { petal: ["#fff3e0", "#ffe0b2"], center: ["#ffe0b2", "#ffb74d"] },
            { petal: ["#e0f2f1", "#b2dfdb"], center: ["#fdd835", "#ffb300"] }
        ];

        this.palette = palettes[Math.floor(Math.random() * palettes.length)];
        
        // Rimuovi steli e boccioli su mobile per performance
        this.hasBud = !isMobile && Math.random() > 0.7;
        this.hasStem = !isMobile && Math.random() > 0.5;
    }

    update() {
        this.rotation += this.rotationSpeed;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.globalAlpha = this.alpha;
        
        for (let i = 0; i < this.petalCount; i++) {
            const angle = (Math.PI * 2 * i) / this.petalCount;
            
            ctx.save();
            ctx.rotate(angle);
            
            ctx.fillStyle = this.palette.petal[0];
            ctx.shadowBlur = 3;
            ctx.shadowColor = "rgba(0,0,0,0.05)";
            
            ctx.beginPath();
            ctx.ellipse(
                this.radius * 0.5,
                0,
                this.radius * 0.6,
                this.radius * 0.3,
                0,
                0,
                Math.PI * 2
            );
            ctx.fill();
            ctx.restore();
        }

        // Centro fiore
        ctx.globalAlpha = this.alpha + 0.1;
        ctx.fillStyle = this.palette.center[0];
        ctx.shadowBlur = 3;
        ctx.beginPath();
        ctx.arc(0, 0, this.radius * 0.2, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.restore();
    }
}

/* ---------------- CREAZIONE OGGETTI - RIDOTTI PER MOBILE ---------------- */

let petals = [];
function initPetals() {
    petals = [];
    // RIDOTTO: molti meno petali su mobile
    const petalCount = isMobile ? 30 : 80;
    for (let i = 0; i < petalCount; i++) {
        petals.push(new Petalo(false));
    }
}

let flowers = [];
function initFlowers() {
    flowers = [];
    // RIDOTTO: molti meno fiori su mobile
    const flowerCount = isMobile ? 8 : 18;
    const minDistance = isMobile ? 150 : 220;
    
    for (let i = 0; i < flowerCount; i++) {
        let placed = false;
        let attempts = 0;
        
        while (!placed && attempts < 500) {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            
            let tooClose = false;
            for (let f of flowers) {
                if (Math.hypot(f.x - x, f.y - y) < minDistance) {
                    tooClose = true;
                    break;
                }
            }
            
            if (!tooClose) {
                flowers.push(new Flower(x, y));
                placed = true;
            }
            attempts++;
        }
        
        if (!placed) {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            flowers.push(new Flower(x, y));
        }
    }
}

initPetals();
initFlowers();

window.addEventListener("resize", () => {
    resizeCanvas();
    initPetals();
    initFlowers();
});

function startHearts() {
    // RIDOTTISSIMO: pochi cuori su mobile
    const heartCount = isMobile ? 15 : 30;
    for (let i = 0; i < heartCount; i++) {
        petals.push(new Petalo(true));
    }
    
    // RIDOTTO: intervallo più lento e meno cuori
    const heartInterval = setInterval(() => {
        if (petals.length < (isMobile ? 60 : 120)) {
            for (let i = 0; i < (isMobile ? 1 : 2); i++) {
                petals.push(new Petalo(true));
            }
        }
    }, isMobile ? 600 : 400);
    
    return heartInterval;
}

/* ---------------- ANIMAZIONE - OPTIMIZED ---------------- */

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    ctx.shadowBlur = 0;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;

    for (let flower of flowers) {
        flower.update();
        flower.draw();
    }

    for (let petal of petals) {
        petal.update();
        petal.draw();
    }

    requestAnimationFrame(animate);
}

animate();

/* ---------------- INTERAZIONE BOTTONI ---------------- */

const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const overlay = document.querySelector('.overlay');

let yesSize = 1;
let noClicks = 0;
let heartInterval = null;

noBtn.addEventListener('click', function(e) {
    e.preventDefault();
    
    // Ottieni le dimensioni del bottone
    const btnWidth = this.offsetWidth;
    const btnHeight = this.offsetHeight;
    
    // Calcola i limiti per mantenere il bottone dentro lo schermo
    const maxX = window.innerWidth - btnWidth - 15;
    const minX = 15;
    const maxY = window.innerHeight - btnHeight - 80;
    const minY = 70;
    
    const randomX = Math.floor(Math.random() * (maxX - minX + 1) + minX);
    const randomY = Math.floor(Math.random() * (maxY - minY + 1) + minY);
    
    this.style.position = 'fixed';
    this.style.left = randomX + 'px';
    this.style.top = randomY + 'px';
    this.style.transform = 'none';
    
    // Aumenta la dimensione del bottone Sì (più contenuto su mobile)
    noClicks++;
    yesSize = 1 + (noClicks * (isMobile ? 0.1 : 0.15));
    yesBtn.style.transform = `scale(${yesSize})`;
    yesBtn.style.fontSize = `${(isMobile ? 1.2 : 1.5) * yesSize}rem`;
    yesBtn.style.padding = `${(isMobile ? 0.7 : 1) * yesSize}rem ${(isMobile ? 1.5 : 2.5) * yesSize}rem`;
    
    // Cambia il testo del bottone No
    const noTexts = ['No', 'Sicura?', 'Davvero?', 'Pensa bene...', 'Non farlo!', 'Clicca Sì!', 'Ti prego!', '❤️?'];
    this.textContent = noTexts[Math.min(noClicks - 1, noTexts.length - 1)];
});

yesBtn.addEventListener('click', function() {
    // Ferma eventuali interval precedenti
    if (heartInterval) {
        clearInterval(heartInterval);
    }
    
    // Rimuovi i bottoni e il messaggio
    document.querySelector('.buttons-container').style.display = 'none';
    document.querySelector('.valentine-message').style.display = 'none';
    
    // Crea messaggio di successo
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.innerHTML = '<div class="heart">❤️</div>EVVIVA!<br><span style="font-size: 1.2rem; color: #666;">❤️Tvb tanto CC❤️</span>';
    document.body.appendChild(successDiv);
    
    // PARTONO I PETALI (CUORI) - VERSIONE LEGGERA
    heartInterval = startHearts();
    
    // Aggiungi pochi fiori rossi
    for (let i = 0; i < (isMobile ? 3 : 6); i++) {
        setTimeout(() => {
            flowers.push(new Flower(
                Math.random() * canvas.width,
                Math.random() * canvas.height
            ));
        }, i * 150);
    }
});

</script>

</body>
</html>
